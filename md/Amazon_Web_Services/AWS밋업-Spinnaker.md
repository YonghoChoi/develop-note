# Spinnaker

* 우분투에 적합하게 제작됨
* 자동화 도구
  * ansible, chef, 솔트 스택, 테라폼
* Spinnaker에는 로그인 페이지가 없음
  * Okta에 SAML 연동하여 대체
  * 인증 후 Spinnaker로 리다이렉트
*  AMI 생성 시간을 단축 시키기 위해 단계 별로 AMI를 생성
  * 기본 패키지 -> 서비스 표준 -> 코드 포함
* Packer랑 Ansible 잘 모르면 도입 어려움
* Docker 이미지도 적용 가능
  * 쿠버네티스 지원을 더 잘함
* Script Stage 사용시 커맨드는 무조건 Jenkins로 연동해서 실행됨
  * 보안적인 이슈 때문에 Spinnaker에서 안하고 Jenkins에 위임
  * 이 스크립트 기능을 사용하려면 이를 위한 Jenkins 설정이 필요함
    * Jenkins 위치와 연동될 젠킨스 프로젝트에 대한 설정을 Spinnaker 설정파일에 지정해주어야함
  * 최근 버전에는 Web Hook을 사용하여 http 요청 전달이 가능해짐
* 배포 단계에서 저지먼트 단계를 둬서 실제 상용 데이터를 가지고 테스트 수행
  * 이를 위해 ELB가 아닌 프록시 서버를 따로 둬서 테스터들만 접근할 수 있도록 구성
  * 변경 사항이 반영된 서버 한대를 띄우고 프록시로 붙어서 데이터는 실제 데이터베이스의 데이터를 사용하여 테스트 수행
  * 테스트가 끝나면 실제 상용 서버의 서버 대수만큼 인스턴스를 생성 (resize 단계)
  * 생성 완료되면 실제 서버와 교체(red/black 배포)
* ELB는 하나만 사용하고 기존 서버 그룹과 새로운 서버 그룹은 오토스케일링 그룹으로 관리
  * 새로운 오토스케일링 그룹을 ELB에 연동하고, 기존 서버 그룹을 ELB에서 제외하는 식으로 서비스 전환
* Spinnaker는 멀티클라우드와 컨테이너 기반 모두 배포 지원
  * Docker는 이미지 관리만 해주는 걸로 추정
* 로컬에 구동 해도 됨
  * key 기반이냐 Role 기반이냐의 차이는 있음.
* 기존에는 카산드라를 데이터베이스로 사용했지만 최근 버전에는 S3를 사용함.
  * S3를 사용하지 못하는 경우에는 미니오를 사용할 수 있음.
    * S3와 똑같은 api를 사용할 수 있음.
      * inode를 많이 사용해서 고갈되는 문제가 있음.



## 키워드

* Packer
* Zabbix : 모니터링
* hal command line tool